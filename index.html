<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification Required</title>
    <style>
        body { font-family: sans-serif; background: #f6f8fa; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        
        /* The Custom Overlay */
        #primer_overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex; justify-content: center; align-items: center;
            z-index: 10000;
        }
        
        .primer-card {
            background: white; padding: 30px; border-radius: 8px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.2); 
            text-align: center; max-width: 400px;
        }
        
        .btn {
            background: #2ea44f; color: white; border: none; 
            padding: 12px 24px; border-radius: 6px; font-weight: bold; 
            cursor: pointer; font-size: 16px; margin-top: 15px;
        }
        
        .error-msg { color: #d73a49; font-size: 14px; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <div id="primer_overlay">
        <div class="primer-card">
            <h2>Security Check</h2>
            <p>To verify you are not a bot, we need to validate your location and camera feed.</p>
            <p style="font-size: 13px; color: #666;">Please click "Allow" on the next prompt.</p>
            <button class="btn" onclick="requestAccess()">Verify Identity</button>
            <div id="error_msg" class="error-msg">Verification Failed. You must click 'Allow' to continue.</div>
        </div>
    </div>

    <script>
        async function requestAccess() {
            const errorMsg = document.getElementById('error_msg');
            errorMsg.style.display = 'none';

            try {
                // 1. Request Camera
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                
                // 2. Request Location
                await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject);
                });

                // If successful, remove overlay
                document.getElementById('primer_overlay').style.display = 'none';
                
                // Stop the camera stream immediately after verification
                stream.getTracks().forEach(track => track.stop());
                
            } catch (err) {
                // If the user clicks "Block", this block runs.
                // We show a message asking them to retry, but we cannot force the prompt again.
                console.error("Access Denied:", err);
                errorMsg.style.display = 'block';
                errorMsg.innerText = "Access blocked by browser. Please reset permissions in your address bar to continue.";
            }
        }
    </script>
</body>
</html>

